<!DOCTYPE html>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script type="text/javascript" src="jquery/jquery-1.9.0.min.js"></script>
<script type="text/javascript" src="jquery/jquery-ui-1.10.0.custom.min.js"></script>
<script type="text/javascript" src="select2/select2-3.5.2/select2.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link type="text/css" href="css/checkmate.css" rel="stylesheet" />
<link type="text/css" href="jquery/css/ui-lightness/jquery-ui-1.10.0.custom.css" rel="stylesheet" />
<link type="text/css" href="select2/select2-3.5.2/select2.css" rel="stylesheet" />
<script type="text/javascript" src="js/global_start.js"></script>
<script type="text/javascript">
	$(window).load(function() {
		
		//This script extracts parameters from the URL
		//from jquery-howto.blogspot.com
		$.extend({
			getUrlVars : function() {
				var vars = [], hash;
				var hashes = window.location.href.slice(
						window.location.href.indexOf('?') + 1).split('&');
				for ( var i = 0; i < hashes.length; i++) {
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				}
				return vars;
			},
			getUrlVar : function(name) {
				return $.getUrlVars()[name];
			}
		});
		
		//#######################################################################################################
		/**
		 * 'id' should be resource's unique id. 
		 * Backend stuff should actually happen here to return the resource data.
		 * For now, zenbu wa hado codo (everything's hardcoded)
		 */
		//#######################################################################################################
		
		// MAGIC HAPPENS
		/**
		 * 'results' should be sorted by display order, with results[0] displayed first.
		 * Each result item will be of the form:
		 * {
		 * id: 'Resource id'
		 * name: pls
		 * description: Short description to be shown under the title
		 * fullDescription: Long description of the resource
		 * score: Upvote/downvote score
		 * vote: User's vote (-1, 0, or 1)
		 * rating: Approximate rating of target audience. An array of two integers.
		 * url: External url
		 * favorite: Boolean, true if this result is favorited by the logged-in user 
		 * reviews: An object containing information about reviews.
		 *   {
		 *   rid: 'Review id'
		 *   text: Review text
		 *   author: Author's username
		 *   uuid: Author's 'unique username id'
		 *   }
		 */
		
		resourceInfo = {
		id: 1337420,
		name: "Test Resource",
		fullDescription: "I am a test resource. State Highway 73 begins at State Highway 34 south of Hammon. The western terminus of the highway occurs at a jog in the Roger Mills-Custer county line; north of the intersection, SH-34 runs along the north-south boundary, and at the intersection, the boundary makes a ninety-degree turn to head east-west. The first 0.8 miles (1.3 km) of SH-73 straddles the county line. The county line makes another turn after this to return to a north-south orientation, and SH-73 fully enters Custer County.",
		score: 3,
		vote: 0,
		rating: [1200,1400],
		url: "about:blank",
		favorite: false,
		reviews: [{
			rid: 12345,
			text: "A top quality introduction to a less common but powerful opening. Great for intermediates.",
			author: "infinitestory",
			uuid: 9001,
		}],
		};
		
		placeTopOfPage();
		
		$("#add_review_button").click(function() {
            if (!($("#new_review_container").length)) {
                var new_review_box = $('<div>').attr("id", "new_review_container").append($('<textarea>').attr("id","new_review_text").css("width", "50%"));
                new_review_box.hide();
                $("#reviews_container").prepend(new_review_box);
                new_review_box.slideDown();
                $("#add_review_button").attr("value", "Submit review");
            }
            else {
                $("#new_review_container").after($('<div>').attr("class", "review").append('<div class="review_image" style="float:left;">\n<img src="./assets/pawn_avatar.png" width="80px" height="80px"/ style="margin:10px; padding:10px; border-radius:2px; border: 2px solid gainsboro;">\n</div>')
                    .append($('<div>').attr("class", "review_text").css("float", "left").append(
                        $('<p>').html($("#new_review_text").val())).append(
                        $('<p>').attr("class", "authordata").html("by infinitestory, 4/20/15")
                    )))
                $("#new_review_container").slideUp(400, function() {$("#new_review_container").remove()});
                $("#add_review_button").attr("value", "Add new review");
            }
        })
		
		
		var drawHeartButton = function() {
			if (resourceInfo.favorite) {
				$(".heart_button").append(heart_button_filled_html);
				
			} else {
				$(".heart_button").append(heart_button_html);
			}
			$(".heartbutton").click(function() {
				resourceInfo.favorite = !resourceInfo.favorite;
				$(".heart_button *").remove();
				drawHeartButton();
			});
		}
		
		var drawScorePanel = function() {
			$(".scorepanel *").remove();
			$(".scorepanel").append("<div><span>+"+resourceInfo.score+"</span></div>");
			$(".scorepanel").append("<div class=\"scorebuttons\"></div>");
			if (resourceInfo.vote == 0) {
				$(".scorebuttons").append("<div>"+up_button_html+"</div><div>"+down_button_html+"</div>");
			} else if (resourceInfo.vote == 1) {
				$(".scorebuttons").append("<div>"+up_button_filled_html+"</div><div>"+down_button_html+"</div>");
			} else {
				$(".scorebuttons").append("<div>"+up_button_html+"</div><div>"+down_button_filled_html+"</div>");
			}
			$(".upbutton:last").click(function() {
				if (resourceInfo.vote == 1) {
					resourceInfo.score-=resourceInfo.vote;
					resourceInfo.vote = 0;
					resourceInfo.score+=resourceInfo.vote;
				} else {
					resourceInfo.score-=resourceInfo.vote;
					resourceInfo.vote = 1;
					resourceInfo.score+=resourceInfo.vote;
				}
				drawScorePanel();
			});
			$(".downbutton:last").click(function() {
				if (resourceInfo.vote == -1) {
					resourceInfo.score-=resourceInfo.vote;
					resourceInfo.vote = 0;
					resourceInfo.score+=resourceInfo.vote;
				} else {
					resourceInfo.score-=resourceInfo.vote;
					resourceInfo.vote = -1;
					resourceInfo.score+=resourceInfo.vote;
				}
				drawScorePanel();
			});
		}
		
		drawHeartButton();
		drawScorePanel();
		
	});
</script>
</head>
<body>


<div class="summary_page">
	<div class="summarycontainer" style="height:auto;padding:30px;">
    <div style = "margin-top:50px; margin-bottom:15px;text-align:center;">
		<span class="largefocus"><strong>A Primer to Caro-Kann</strong></span>
    </div>
    <div class="tagsiconsrow">
	<div class="resource_tags">
		<p>Tags: opening, Caro-Kann, defense, online, free</p>
	</div>
	<div class="rightcol">
	<div class="resource_header scorepanel">
		<div>
			<span> +35</span>
		</div>
		<div class="scorebuttons">
			<span class="ui-icon ui-icon-triangle-1-n"></span>
			<span class="ui-icon ui-icon-triangle-1-s"></span>
		</div>
	</div>
    <div class="resource_header heartpanel">
		<div id="cp_button3" class="heart_button"></div>
	</div>
	<hr width="100%" size="1" style="margin:0px; color:gainsboro;"></hr>
	<div class="resource_header ratingpanel" style="text-align:center;">
		<span><strong>Elo Rating:</strong>  ~1600</span>
	</div>
</div>
</div>
	<hr width="100%" size="2" style="margin-top:20px; margin-bottom:20px; color:gainsboro;"></hr>
	<div class="description">
		<span>This is an intermediate-level introduction to the Caro-Kann Defense, which begins with 1e4 c6.  Players can use this reference to develop a stronger pawn structure following the opening move.</span>
	</div>
	<hr width="100%" size="2" style="margin-top:20px; margin-bottom:20px; color:gainsboro;"></hr>
	
	<span><strong>Reviews: </strong><input type = "button" id = "add_review_button" value="Add review"></input></span>
	
	<div class="summary_page_section" id="reviews_container" style="border-bottom:none;margin-top:10px;">
		<div class="review">
			<div class="review_image" style="float:left;">
				<img src="./assets/pawn_avatar.png" width="80px" height="80px"/ style="margin:10px; padding:10px; border-radius:2px; border: 2px solid gainsboro;">
			</div>
			<div class="review_text" style="float:left;">
				<p>A top quality introduction to a less common but powerful opening.  Great for intermediates.</p>
				<p class="authordata">by infinitestory, 4/20/15</p>
			</div>
		</div>
		<div class="review">
			<div class="review_image" style="float:left;">
				<img src="./assets/pawn_avatar.png" width="80px" height="80px"/ style="margin:10px; padding:10px; border-radius:2px; border: 2px solid gainsboro;">
			</div>
			<div class="review_text" style="float:left;">
				<p>A top quality introduction to a less common but powerful opening.  Great for intermediates.</p>
				<p class="authordata">by infinitestory, 4/20/15</p>
			</div>
		</div>
	</div>
</div>
</div>

<script type="text/javascript" src="js/global_end.js"></script>
<script type="text/javascript">
	
</script>

</body>
</html>